'***************************************************************************
'Galil Single DOF Flapper Control
'Author: Cameron Urban
'Modified by: Ronan Gissler (November 2022)
'***************************************************************************
ST; 'Stop program and and motion for all motors
MO; 'Turns off all motors

'(all commands ending with B in regards to that motor)
MTB=-2; 'Set motor type to -2 (Stepper motor with active high step pulses)
OEB=1; 'Shut off motor if position error exceeds limit
AGB=1; 'Amplifier gain (0-3), 1 -> 1.5 A/Phase
AUB=12; 'Amplifier current loop, inductance 8mH -> 12
LCB=1; '25% holding current immediately after move finishes

KSB=16; 'Set stepper smoothing
YAB=16; 'Step Drive Resolution (counts/motor-step)
YBB=200; 'Step Motor Resolution (motor-steps/rev)

SH B; 'Servo the motor - resetting motor's coordinate system
WT100; 'Wait for 100 ms

ACB=5000; 'Set acceleration of motor (counts/second^2)
DCB=5000; 'Set deceleration of motor (counts/second^2)
SPB=20000; 'Set speed of motor (counts/second)

'Move forward one revolution
PRB=53000; 'Set distance and direction of next move (counts)

BG B; 'Begin motion using preset value
MC B; 'Wait until motion is complete before moving on (MC better than AM)
ST B; 'Stop motor
MO B; 'Turn off power to motor

SH B; 'Servo the motor - resetting motor's coordinate system
WT1000; 'Wait for 1000 ms

'Move backward one revolution
PRB=-53000; 'Set distance and direction of next move (counts)

BG B; 'Begin motion using preset value
MC B; 'Wait until motion is complete before moving on (MC better than AM)
ST B; 'Stop motor
MO B; 'Turn off power to motor

EN; 'End program