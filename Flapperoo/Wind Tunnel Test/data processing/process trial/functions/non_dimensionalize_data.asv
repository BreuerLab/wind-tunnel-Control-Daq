% Author: Ronan Gissler
% Last updated: October 2023

% Inputs:
% results - (n x 6) raw force transducer data
% file_name - raw data file name
% Returns:
% norm_data - (n x 6) non-dimensionalized force transducer data
% St - Strouhal number for this trial
% Re - Reynolds number for this trial
function [norm_data, St, Re] = non_dimensionalize_data(results, file_name)
    [case_name, type, wing_freq, AoA, U] = parse_filename(file);
    
    % Constant values based on geometry of wings
    wing_span = 0.266; % m
    wing_chord = 0.088; % m
    total_area = wing_span * wing_chord * 2; % m^2, roughly
    wing_length = 0.257; % meters
    angle_up = 32; % degrees
    angle_down = 30; % degrees
    
    % Values obtained from wind tunnel measurements
    path = "../../wind tunnel data/";
    file_name = strrep(file_name,"experiment","wind_tunnel");
    file_name = strrep(file_name,"csv","mat");
    load(path + file_name);
    
 
    
    wind_speed = AFAM_Tunnel.Speed;
    density = AFAM_Tunnel.Density;
    Re = AFAM_Tunnel.Reynolds * wing_length;
    
    if (isnan(wind_speed) || isnan(density) || isnan(Re))
        disp("Using default values for air speed, density, and viscosity for case:")
        disp(case_name)
        density = 1.204; % kg/m^3 at 20 C 1 atm
        kin_vis = 1.6 * 10^(-5); % m^2/s
        wind_speed = U;
        Re = (wind_speed * wing_length) / kin_vis;
    end
    St = (wing_freq * amplitude) / wind_speed;
    
    % should vel be 60 deg times wing_freq instead of 2pi?
    norm_F_factor = (0.5 * density * total_area * (wind_speed + ((amplitude*2)*wing_freq))^2);
    norm_M_factor = norm_F_factor * wing_chord;

    norm_F = results(:,1:3) / norm_F_factor;
    norm_M = results(:,4:6) / norm_M_factor;
    norm_data = [norm_F, norm_M];
end